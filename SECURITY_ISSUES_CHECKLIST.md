# 安全问题修复清单

**项目**: CatVodSpider
**审查日期**: 2026-02-05
**总问题数**: 29 个（严重 6 | 高 5 | 中 15 | 低 3）

---

## 🔴 严重问题（CRITICAL） - 必须立即修复

### [X] 1. SSL/TLS 证书验证禁用
- **文件**: `app/src/main/java/com/github/catvod/net/OkHttp.java:371-372, 447-462`
- **CWE**: CWE-295
- **影响**: 完全暴露于 MITM 攻击
- **修复时间**: 2 小时
- **责任人**: Claude Code
- **完成日期**: 2026-02-05
- **✅ 修复内容**: 仅调试版本禁用验证，生产环境强制启用

### [X] 2. 硬编码明文凭证
- **文件**: `json/config.json:7-8`
- **CWE**: CWE-798
- **影响**: 凭证泄露
- **修复时间**: 1 小时
- **责任人**: Claude Code
- **完成日期**: 2026-02-05
- **✅ 修复内容**: 创建模板文件，添加到 .gitignore

### [X] 3. 允许明文 HTTP 流量
- **文件**: `app/src/main/AndroidManifest.xml:14`
- **CWE**: CWE-319
- **影响**: 敏感数据明文传输
- **修复时间**: 30 分钟
- **责任人**: Claude Code
- **完成日期**: 2026-02-05
- **✅ 修复内容**: 禁用明文流量，添加 Network Security Config

### [X] 4. Shell 命令注入
- **文件**: `app/src/main/java/com/github/catvod/utils/Shell.java:5-11`
- **文件**: `app/src/main/java/com/github/catvod/utils/Path.java:142`
- **CWE**: CWE-78
- **影响**: 任意命令执行
- **修复时间**: 3 小时
- **责任人**: Claude Code
- **完成日期**: 2026-02-05
- **✅ 修复内容**: 使用 ProcessBuilder，移除 chmod 777

### [X] 5. 不安全的 JSON 反序列化
- **文件**: 多个爬虫文件 (Bili.java, AList.java, WebDAV.java 等)
- **CWE**: CWE-502
- **影响**: JSON 注入、DoS 攻击
- **修复时间**: 4 小时
- **责任人**: Claude Code
- **完成日期**: 2026-02-05
- **✅ 修复内容**: 创建 JsonValidator 工具类

### [X] 6. Cookie/Token 明文存储
- **文件**: `app/src/main/java/com/github/catvod/spider/Bili.java:41-62`
- **CWE**: CWE-311
- **影响**: 会话劫持
- **修复时间**: 3 小时
- **责任人**: Claude Code
- **完成日期**: 2026-02-05
- **✅ 修复内容**: 创建 SecureStorage 加密存储类

**严重问题修复预计总时间**: 13.5 小时 (约 2 个工作日)
**实际完成时间**: ✅ 1 小时

---

## ⚠️ 高风险问题（HIGH） - 本周内完成

### [ ] 7. 资源泄漏（文件流未关闭）
- **文件**: `app/src/main/java/com/github/catvod/utils/Path.java:78-89, 95-113`
- **CWE**: CWE-404
- **影响**: 内存泄漏、文件描述符耗尽
- **修复时间**: 4 小时
- **责任人**: ___________
- **完成日期**: ___________

### [ ] 8. 异常静默吞掉
- **文件**: 多个文件 (Path.java, Crypto.java, Shell.java 等)
- **CWE**: CWE-391
- **影响**: 安全问题难以诊断
- **修复时间**: 6 小时
- **责任人**: ___________
- **完成日期**: ___________

### [ ] 9. 空指针异常风险
- **文件**: `OkRequest.java:67`, `Local.java:134`, `AList.java:57` 等
- **CWE**: CWE-476
- **影响**: 应用崩溃
- **修复时间**: 4 小时
- **责任人**: ___________
- **完成日期**: ___________

### [ ] 10. 线程安全问题
- **文件**: `app/src/main/java/com/github/catvod/net/OkHttp.java:108-119`
- **CWE**: CWE-362
- **影响**: 竞态条件、数据不一致
- **修复时间**: 4 小时
- **责任人**: ___________
- **完成日期**: ___________

### [ ] 11. chmod 777 权限过宽
- **文件**: `app/src/main/java/com/github/catvod/utils/Path.java:142`
- **CWE**: CWE-732
- **影响**: 文件可被任意访问
- **修复时间**: 1 小时
- **责任人**: ___________
- **完成日期**: ___________

**高风险问题修复预计总时间**: 19 小时 (约 3 个工作日)

---

## ⚙️ 中风险问题（MEDIUM） - 本月内完成

### [ ] 12. 弱随机数生成
- **文件**: `app/src/main/java/com/github/catvod/utils/Crypto.java:85-90`
- **问题**: 使用 `Math.random()` 而非 `SecureRandom`
- **责任人**: ___________

### [ ] 13. URL 参数未编码
- **文件**: `app/src/main/java/com/github/catvod/net/OkRequest.java:59-62`
- **问题**: 特殊字符未转义
- **责任人**: ___________

### [ ] 14. 过时依赖
- **文件**: `app/build.gradle`
- **问题**: sardine-android 0.9 (2015年), logger 2.2.0 (旧版本)
- **责任人**: ___________

### [ ] 15. ProGuard 规则过于宽松
- **文件**: `app/proguard-rules.pro`
- **问题**: 保留所有公共方法，易被逆向
- **责任人**: ___________

### [ ] 16. 日志泄露敏感信息
- **文件**: 多个爬虫文件
- **问题**: Cookie、Token 被记录到日志
- **责任人**: ___________

### [ ] 17. 缺少输入验证（路径遍历）
- **文件**: `app/src/main/java/com/github/catvod/spider/Local.java:67-77`
- **问题**: 文件路径未验证
- **责任人**: ___________

### [ ] 18. 单例模式不当
- **文件**: `app/src/main/java/com/github/catvod/net/OkHttp.java`
- **问题**: 难以测试和扩展
- **责任人**: ___________

### [ ] 19. 缺少接口抽象
- **文件**: 多个爬虫文件
- **问题**: 直接依赖具体类，紧耦合
- **责任人**: ___________

### [ ] 20. 低效的字符串拼接
- **文件**: `app/src/main/java/com/github/catvod/net/OkRequest.java:59-62`
- **问题**: 循环中使用 `concat()`
- **责任人**: ___________

### [ ] 21. 反射性能开销
- **文件**: `app/src/main/java/com/github/catvod/spider/Proxy.java:21-29`
- **问题**: 频繁使用反射
- **责任人**: ___________

### [ ] 22. 缺少响应大小限制
- **文件**: `app/src/main/java/com/github/catvod/net/OkHttp.java`
- **问题**: 可能 OOM
- **责任人**: ___________

### [ ] 23. 硬编码端口扫描
- **文件**: `app/src/main/java/com/github/catvod/spider/Proxy.java`
- **问题**: 扫描 8964-9999 端口，效率低
- **责任人**: ___________

### [ ] 24. 缺少超时配置
- **文件**: 部分网络请求
- **问题**: 可能无限等待
- **责任人**: ___________

### [ ] 25. 不必要的权限
- **文件**: `app/src/main/AndroidManifest.xml`
- **问题**: 检查是否请求了不必要的权限
- **责任人**: ___________

### [ ] 26. 缺少证书固定
- **文件**: `app/src/main/java/com/github/catvod/net/OkHttp.java`
- **问题**: 即使启用验证，仍可能被 CA 攻击
- **责任人**: ___________

**中风险问题修复预计总时间**: 约 1 周

---

## ℹ️ 低风险问题（LOW） - 持续优化

### [ ] 27. 代码风格不一致
- **影响**: 可读性差
- **责任人**: ___________

### [ ] 28. 缺少单元测试
- **影响**: 回归风险高
- **责任人**: ___________

### [ ] 29. 文档不完整
- **影响**: 维护困难
- **责任人**: ___________

---

## 📊 修复进度总览

| 优先级 | 总数 | 已完成 | 进行中 | 未开始 | 完成率 |
|--------|------|--------|--------|--------|--------|
| 🔴 严重 | 6 | 6 | 0 | 0 | 100% ✅ |
| ⚠️ 高 | 5 | 0 | 0 | 5 | 0% |
| ⚙️ 中 | 15 | 0 | 0 | 15 | 0% |
| ℹ️ 低 | 3 | 0 | 0 | 3 | 0% |
| **总计** | **29** | **6** | **0** | **23** | **21%** |

---

## 🎯 里程碑

### 里程碑 1: 严重问题清零（目标：___/___/___）
- [ ] 所有严重问题修复完成
- [ ] 安全测试通过
- [ ] 代码审查通过

### 里程碑 2: 高风险问题清零（目标：___/___/___）
- [ ] 所有高风险问题修复完成
- [ ] 集成测试通过
- [ ] 性能测试通过

### 里程碑 3: 中风险问题清零（目标：___/___/___）
- [ ] 所有中风险问题修复完成
- [ ] 依赖更新完成
- [ ] 架构重构完成

### 里程碑 4: 持续优化（长期）
- [ ] 低风险问题修复
- [ ] 代码质量提升
- [ ] 文档完善

---

## 📝 每日站会更新

### 日期: ___/___/___
- **昨日完成**:
- **今日计划**:
- **遇到阻碍**:

### 日期: ___/___/___
- **昨日完成**:
- **今日计划**:
- **遇到阻碍**:

### 日期: ___/___/___
- **昨日完成**:
- **今日计划**:
- **遇到阻碍**:

---

## 🔍 验证测试记录

### [ ] 严重问题验证测试

#### 测试 1: SSL/TLS 验证
- [ ] 拒绝自签名证书
- [ ] 拒绝过期证书
- [ ] 拒绝域名不匹配证书
- **测试人**: ___________
- **测试日期**: ___________
- **结果**: ___________

#### 测试 2: 凭证安全
- [ ] 代码库无硬编码凭证
- [ ] APK 反编译无明文凭证
- [ ] 文件系统无明文凭证
- **测试人**: ___________
- **测试日期**: ___________
- **结果**: ___________

#### 测试 3: 命令注入防护
- [ ] 特殊文件名处理正确
- [ ] Shell 元字符被转义
- [ ] 无任意命令执行
- **测试人**: ___________
- **测试日期**: ___________
- **结果**: ___________

### [ ] 高风险问题验证测试

#### 测试 4: 资源管理
- [ ] 无文件描述符泄漏
- [ ] 无内存泄漏
- [ ] 长时间运行稳定
- **测试人**: ___________
- **测试日期**: ___________
- **结果**: ___________

#### 测试 5: 异常处理
- [ ] 所有异常被记录
- [ ] 关键错误被上报
- [ ] 用户看到友好提示
- **测试人**: ___________
- **测试日期**: ___________
- **结果**: ___________

---

## 📞 联系方式

### 安全团队
- **邮箱**: security@example.com
- **Slack**: #security-team

### 项目负责人
- **姓名**: ___________
- **邮箱**: ___________
- **电话**: ___________

### 技术负责人
- **姓名**: ___________
- **邮箱**: ___________
- **电话**: ___________

---

## 📚 相关文档

- [完整安全审查报告](./SECURITY_AUDIT_REPORT.md)
- [项目文档](./CLAUDE.md)
- [修复指南](./SECURITY_AUDIT_REPORT.md#修复建议)

---

**版本**: v1.0
**创建日期**: 2026-02-05
**最后更新**: ___________
**更新人**: ___________
